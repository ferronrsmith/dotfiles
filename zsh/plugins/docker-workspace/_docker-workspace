#compdef docker-workspace

# docker-workspace autocompletion for groupby custum docker image
# Author: Ferron Hanse (ferronrsmith@gmail.com)

# ----- Helper functions
# Output a selectable list of all running docker containers
__docker_containers() {
    declare -a cont_cmd
    query="docker ps -aq | xargs docker inspect -f '{{.Name}}' | rev | cut -d '-' -f 1 | rev | awk '{print $1}'"
	if which boot2docker >/dev/null; then
		cont_cmd=($(boot2docker ssh "$query"))
	else
		cont_cmd=($(eval "$query"))
	fi
    _describe 'containers' cont_cmd
}

__info() {
    # no arguments
}

__rm() {
    __docker_containers
}

__bash() {
    __docker_containers
}

__mk() {
    __docker_containers
}

__clean() {
    __docker_containers
}

__version() {
    # no arguments
}


# end commands ---------
# ----------------------

local -a _1st_arguments
_1st_arguments=(
    "bash":"connect to a workspace container via ssh and invoke a bash shell"
    "mk":"Create a new workspace container"
    "rm":"Remove a workspace container"
    "clean":"Remove and recreate a workspace"
)

_arguments '*:: :->command'

if (( CURRENT == 1 )); then
    _describe -t commands "docker command" _1st_arguments
    return
fi

local -a _command_args
case "$words[1]" in
    bash)
        __bash ;;
    mk)
        __mk ;;
    rm)
        __rm ;;
    info)
        __info ;;    
    clean)
        __clean ;;            
    version)
        __version ;;
esac
