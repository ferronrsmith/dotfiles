#compdef docker-dev

# Docker autocompletion for groupby custum docker image
# Author: Ferron Hanse (ferronrsmith@gmail.com)

# ----- Helper functions
# Output a selectable list of all running docker containers
__docker_containers() {
    declare -a cont_cmd
    query="docker ps -aq | xargs docker inspect -f '{{.Name}}' | rev | cut -d '-' -f 1 | rev | awk '{print $1}'"
	if which boot2docker >/dev/null; then
		cont_cmd=($(boot2docker ssh "$query"))
	else
		cont_cmd=($(eval "$query"))
	fi   
    _describe 'containers' cont_cmd
}

__info() {
    # no arguments
}

__rm() {
    __docker_containers
}

__start() {
    __docker_containers
}

__ide() {
    __docker_containers
}

__bash() {
    __docker_containers
}

__mk() {
    __docker_containers
}

__update() {
    __docker_containers
}

__stop() {
    __docker_containers
}


__version() {
    # no arguments
}


# end commands ---------
# ----------------------

local -a _1st_arguments
_1st_arguments=(
    "ide":"start intellij ide in a dev container"
    "bash":"connect to a dev container via ssh and invoke a bash shell"
    "mk":"Create a new dev container"
    "rm":"Remove a dev container"
    "start":"Start a stopped dev container"
    "stop":"Stop a running dev container"
    "update":"Remove and recreate a dev container"
)

_arguments '*:: :->command'

if (( CURRENT == 1 )); then
    _describe -t commands "docker command" _1st_arguments
    return
fi

local -a _command_args
case "$words[1]" in
    ide)
        __ide ;;
    bash)
        __bash ;;
    mk)
        __mk ;;
    rm)
        __rm ;;
    start)
        __start ;;
    stop)
        __stop ;;
    update)
        __update ;; 
    info)
        __info ;;        
    version)
        __version ;;
esac
